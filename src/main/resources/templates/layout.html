<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:fragment="content(title, pages)">
<head>
    <meta charset="UTF-8">
    <meta id="meta-role" name="role" th:content="${#authentication.authorities[0].authority}"/>
    <meta id="meta-email" name="email" th:content="${#authentication.name}"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <title th:text="${title}">Web App</title>

</head>

<body class="min-h-screen flex flex-col bg-gray-50 text-gray-800 dark:bg-gray-950 dark:text-gray-200 transition-colors duration-300">

<!-- ** ===== HEADER ===== ** -->
<header class="bg-white dark:bg-gray-900 shadow-sm sticky top-0 z-50 border-b border-gray-200 dark:border-gray-700 transition-colors duration-300">
    <div class="container mx-auto flex items-center justify-between px-6 py-3">

        <!-- Logo -->
        <a th:href="@{/}"
           class="text-2xl font-semibold bg-gradient-to-r from-purple-800 to-pink-600 dark:from-indigo-400 dark:to-purple-500 text-transparent bg-clip-text">
            HealthCare
        </a>

        <!-- Thanh t√¨m ki·∫øm -->
        <div class="hidden md:flex items-center w-1/3">
            <input type="text"
                   placeholder="T√¨m b√°c sƒ©, khoa ho·∫∑c d·ªãch v·ª• kh√°m..."
                   class="w-full px-4 py-2 rounded-l-full border border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 outline-none transition">
            <button class="px-4 py-2 bg-blue-600 text-white rounded-r-full hover:bg-blue-500 transition">
                üîç
            </button>
        </div>

        <!-- Navigation + Icons -->
        <nav class="flex items-center space-x-6 text-sm font-medium">

            <!-- Menu ch√≠nh -->
            <a href="/" class="hover:text-blue-600 dark:hover:text-blue-400 transition">Trang ch·ªß</a>
            <a href="/bookings" class="hover:text-blue-600 dark:hover:text-blue-400 transition">ƒê·∫∑t l·ªãch</a>
            <a href="/about" class="hover:text-blue-600 dark:hover:text-blue-400 transition">Gi·ªõi thi·ªáu</a>

            <!-- Icon th√¥ng b√°o -->
            <div class="relative cursor-pointer">
                <span class="text-xl">üîî</span>
                <span class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full"></span>
            </div>

            <!-- Gi·ªè l·ªãch kh√°m -->
            <div class="relative cursor-pointer">
                <span class="text-xl">ü©∫</span>
                <span class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full"></span>
            </div>

            <!-- üîπ Khu v·ª±c auth -->
            <div id="auth-buttons" class="flex items-center space-x-4">
                <!-- üîπ N·∫øu CH∆ØA ƒëƒÉng nh·∫≠p -->
                <th:block sec:authorize="!isAuthenticated()">
                    <a th:href="@{/auth/login}"
                       class="text-blue-600 dark:text-blue-400 font-semibold hover:underline text-xs">ƒêƒÉng nh·∫≠p</a>

                    <a th:href="@{/auth/register}"
                       class="bg-blue-600 text-white text-xs px-4 py-1 rounded-full hover:bg-blue-500 transition">
                        ƒêƒÉng k√Ω
                    </a>
                </th:block>

                <!-- üîπ N·∫øu ƒê√É ƒëƒÉng nh·∫≠p -->
                <th:block sec:authorize="isAuthenticated()">
                    <div id="user-menu" class="relative group">
                        <div class="flex items-center space-x-2 cursor-pointer select-none">
                            <img src="/assets/images/avatar.jpg" alt="user"
                                 class="w-8 h-8 rounded-full border border-gray-300 dark:border-gray-600">
                            <span class="dark:text-gray-100 font-medium">
                                    Hi,
                                <span class="font-semibold text-xs" sec:authentication="name"></span>
                            </span>
                        </div>
                        <!-- Dropdown menu -->
                        <div id="layout-dropdown"
                             class="absolute right-0 top-10 w-52 bg-white dark:bg-gray-800 shadow-lg rounded-xl border
                             border-gray-200 dark:border-gray-700 opacity-0 invisible transition-all duration-300">
                            <ul class="py-2 text-sm text-gray-700 dark:text-gray-200 cursor-pointer">
                                <th:block th:each="role : ${@AccountService.getRoles(#authentication.name)}">
                                    <!-- PATIENT -->
                                    <th:block th:if="${role.name == 'ROLE_PATIENT'}">
                                        <li id="patient-manage"><a href="/patient"
                                                                   class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">Qu·∫£n
                                            l√Ω c√° nh√¢n</a></li>
                                        <li id="patient-profile"><a
                                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">H·ªì s∆°
                                            c√° nh√¢n</a></li>
                                        <li id="patient-appointment"><a
                                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">L·ªãch
                                            kh√°m</a></li>
                                        <li id="patient-profile-appointment"><a
                                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">H·ªì s∆°
                                            b·ªánh √°n</a></li>
                                        <li id="patient-alert"><a
                                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">Th√¥ng
                                            b√°o</a></li>
                                        <li>
                                            <hr class="my-2 border-gray-200 dark:border-gray-600">
                                        </li>
                                        <li><a
                                                id="btn-logout-patient"
                                                th:attr="data-account=${#authentication.name}"
                                                th:href="@{/auth/logout}"
                                                class="block px-4 py-2 text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700">ƒêƒÉng
                                            xu·∫•t</a></li>
                                    </th:block>
                                    <!-- SUPER ADMIN -->
                                    <th:block th:if="${role.name == 'ROLE_SUPER_ADMIN'}">
                                        <li><a th:href="@{/super-admin}"
                                               class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">B·∫£ng
                                            ƒëi·ªÅu khi·ªÉn</a></li>
                                        <li id="super-admin-manage-account"><a
                                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">Qu·∫£n l√Ω
                                            t√†i kho·∫£n</a></li>
                                        <li id="super-admin-middleware"><a
                                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">Ph√¢n
                                            quy·ªÅn h·ªá th·ªëng</a></li>
                                        <li id="super-admin-log"><a
                                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">Nh·∫≠t k√Ω
                                            h·ªá th·ªëng</a></li>
                                        <li>
                                            <hr class="my-2 border-gray-200 dark:border-gray-600">
                                        </li>
                                        <li><a th:href="@{/auth/logout}" th:attr="data-account=${#authentication.name}"
                                               id="btn-logout-super-admin"
                                               class="block px-4 py-2 text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700">ƒêƒÉng
                                            xu·∫•t</a></li>
                                    </th:block>
                                    <!-- ADMIN -->
                                    <th:block th:if="${role.name == 'ROLE_ADMIN'}">
                                        <li><a th:href="@{/admin}"
                                               class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">Trang
                                            qu·∫£n tr·ªã</a></li>
                                        <li id="admin-manage-doctor"><a
                                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">Qu·∫£n l√Ω
                                            b√°c sƒ©</a></li>
                                        <li id="admin-manage-patient"><a
                                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">Qu·∫£n l√Ω
                                            b·ªánh nh√¢n</a></li>
                                        <li id="admin-system-report"><a
                                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">B√°o c√°o
                                            th·ªëng k√™</a></li>
                                        <li>
                                            <hr class="my-2 border-gray-200 dark:border-gray-600">
                                        </li>
                                        <li><a
                                                id="btn-logout-admin"
                                                sec:authentication="name"
                                                th:attr="data-account=${#authentication.name}"
                                                class="block px-4 py-2 text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700">ƒêƒÉng
                                            xu·∫•t</a></li>
                                    </th:block>
                                    <!-- DOCTOR -->
                                    <th:block th:if="${role.name == 'ROLE_DOCTOR'}">
                                        <li><a th:href="@{/doctor}"
                                               class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">L·ªãch l√†m
                                            vi·ªác</a></li>
                                        <li id="doctor-manage-patient"><a
                                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">B·ªánh
                                            nh√¢n c·ªßa t√¥i</a></li>
                                        <li id="doctor-appointment"><a
                                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">H·ªì s∆°
                                            b·ªánh √°n</a></li>
                                        <li>
                                            <hr class="my-2 border-gray-200 dark:border-gray-600">
                                        </li>
                                        <li><a th:href="@{/auth/logout}"
                                               id="btn-logout-doctor"
                                               th:attr="data-account=${#authentication.name}"
                                               class="block px-4 py-2 text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700">ƒêƒÉng
                                            xu·∫•t</a></li>
                                    </th:block>
                                </th:block>
                            </ul>
                        </div>
                    </div>
                </th:block>
            </div>

            <!-- N√∫t toggle dark/light -->
            <button id="theme-toggle"
                    class="ml-4 px-3 py-1 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition flex items-center">
                <span class="light-mode-icon">üåû</span>
                <span class="dark-mode-icon hidden">üåô</span>
            </button>
        </nav>
    </div>
</header>

<!-- ** ===== MAIN CONTENT ===== ** -->
<main id="root" class="flex-1 container mx-auto p-6 transition-colors duration-300">
    <th:block th:replace="${pages}?:_"></th:block>
    <input id="register-email-redirect" type="hidden" th:value="${email}">
</main>

<!-- ===== FOOTER ===== -->
<!-- ===== FOOTER ===== -->
<footer class="bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 transition-colors duration-300">
    <div class="container mx-auto px-6 py-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-10">

        <!-- C·ªôt 1: Logo & m√¥ t·∫£ -->
        <div>
            <h3 class="text-2xl font-bold bg-gradient-to-r from-purple-700 to-pink-500 bg-clip-text text-transparent">
                HealthCare
            </h3>
            <p class="mt-3 text-sm leading-relaxed text-gray-600 dark:text-gray-400">
                N·ªÅn t·∫£ng chƒÉm s√≥c s·ª©c kh·ªèe to√†n di·ªán, gi√∫p b·∫°n d·ªÖ d√†ng ƒë·∫∑t l·ªãch, tra c·ª©u h·ªì s∆° y t·∫ø,
                v√† k·∫øt n·ªëi v·ªõi c√°c chuy√™n gia h√†ng ƒë·∫ßu.
            </p>

            <div class="mt-4 flex space-x-3 text-xl">
                <a href="#" class="hover:text-blue-600 transition">üìò</a>
                <a href="#" class="hover:text-pink-500 transition">üì∏</a>
                <a href="#" class="hover:text-sky-500 transition">üê¶</a>
                <a href="#" class="hover:text-red-500 transition">‚ñ∂Ô∏è</a>
            </div>
        </div>

        <!-- C·ªôt 2: H·ªá th·ªëng chi nh√°nh -->
        <div>
            <h3 class="text-lg font-semibold mb-4 text-blue-600 dark:text-blue-400">H·ªá th·ªëng chi nh√°nh</h3>
            <ul class="space-y-2 text-sm">
                <li>üè• H√† N·ªôi: 123 Ph·ªë Hu·∫ø, Hai B√† Tr∆∞ng</li>
                <li>üè• TP.HCM: 45 Nguy·ªÖn Th·ªã Minh Khai, Q.1</li>
                <li>üè• ƒê√† N·∫µng: 56 Nguy·ªÖn VƒÉn Linh, H·∫£i Ch√¢u</li>
                <li>üè• C·∫ßn Th∆°: 78 Tr·∫ßn H∆∞ng ƒê·∫°o, Ninh Ki·ªÅu</li>
                <li>üè• H·∫£i Ph√≤ng: 89 L·∫°ch Tray, Ng√¥ Quy·ªÅn</li>
            </ul>
        </div>

        <!-- C·ªôt 3: D·ªãch v·ª• n·ªïi b·∫≠t -->
        <div>
            <h3 class="text-lg font-semibold mb-4 text-blue-600 dark:text-blue-400">D·ªãch v·ª• n·ªïi b·∫≠t</h3>
            <ul class="space-y-2 text-sm">
                <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400 transition">Kh√°m t·ªïng qu√°t</a></li>
                <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400 transition">X√©t nghi·ªám m√°u</a></li>
                <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400 transition">Ch·∫©n ƒëo√°n h√¨nh ·∫£nh</a>
                </li>
                <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400 transition">Kh√°m tim m·∫°ch</a></li>
                <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400 transition">Kh√°m nhi & s·∫£n ph·ª•
                    khoa</a></li>
            </ul>
        </div>

        <!-- C·ªôt 4: T·ª´ kh√≥a & t√¨m ki·∫øm -->
        <div>
            <h3 class="text-lg font-semibold mb-4 text-blue-600 dark:text-blue-400">T·ª´ kh√≥a ph·ªï bi·∫øn</h3>
            <div class="flex flex-wrap gap-2 text-xs">
                <span class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-full hover:bg-blue-100 dark:hover:bg-blue-600 cursor-pointer transition">B√°c sƒ© gi·ªèi</span>
                <span class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-full hover:bg-blue-100 dark:hover:bg-blue-600 cursor-pointer transition">Kh√°m s·ª©c kh·ªèe</span>
                <span class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-full hover:bg-blue-100 dark:hover:bg-blue-600 cursor-pointer transition">T∆∞ v·∫•n online</span>
                <span class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-full hover:bg-blue-100 dark:hover:bg-blue-600 cursor-pointer transition">B·∫£o hi·ªÉm y t·∫ø</span>
                <span class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-full hover:bg-blue-100 dark:hover:bg-blue-600 cursor-pointer transition">Kh√°m dinh d∆∞·ª°ng</span>
            </div>

            <form id="search-footer-form" class="mt-4 flex items-center">
                <input type="text" placeholder="T√¨m b√†i vi·∫øt, d·ªãch v·ª•..."
                       class="w-full px-3 py-2 rounded-l-md border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 outline-none text-sm transition">
                <button type="submit"
                        class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-r-md hover:from-blue-500 hover:to-purple-500 transition">
                    üîç
                </button>
            </form>
        </div>

        <!-- C·ªôt 5: Th√¥ng tin & li√™n h·ªá -->
        <div>
            <h3 class="text-lg font-semibold mb-4 text-blue-600 dark:text-blue-400">Li√™n h·ªá & h·ªó tr·ª£</h3>
            <ul class="space-y-2 text-sm">
                <li>üìû Hotline: <span class="font-semibold text-blue-600 dark:text-blue-400">1900 1234</span></li>
                <li>‚úâÔ∏è Email: support@healthcare.vn</li>
                <li>‚è∞ Gi·ªù l√†m vi·ªác: 7h00 - 21h00 (T2 - CN)</li>
                <li>üìç VƒÉn ph√≤ng: 45 Nguy·ªÖn Th·ªã Minh Khai, Q.1, TP.HCM</li>
            </ul>

            <div class="mt-4">
                <h4 class="font-medium text-sm mb-2">ƒêƒÉng k√Ω nh·∫≠n tin m·ªõi</h4>
                <form id="newsletter-form" class="flex items-center">
                    <input type="email" placeholder="Nh·∫≠p email c·ªßa b·∫°n..."
                           class="w-full px-2 py-2 rounded-l-md border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 outline-none text-sm transition">
                    <button type="submit"
                            class="px-1 py-1 bg-gradient-to-r from-purple-700 to-pink-600 text-white text-xs rounded-r-md hover:from-purple-600 hover:to-pink-500 transition">
                        ƒêƒÉng k√Ω
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- D√≤ng ngƒÉn -->
    <div class="border-t border-gray-200 dark:border-gray-700 my-6"></div>

    <!-- Th√¥ng tin cu·ªëi -->
    <div class="container mx-auto px-6 pb-6 text-center text-xs text-gray-500 dark:text-gray-400 space-y-2">
        <p>C√¥ng ty C·ªï ph·∫ßn Y t·∫ø HealthCare Vi·ªát Nam | MST: 0312345678 | GPƒêKKD: 0123/HCVN</p>
        <p>¬© 2025 HealthCare Vi·ªát Nam. B·∫£o l∆∞u m·ªçi quy·ªÅn. | <a href="#" class="hover:text-blue-500">Ch√≠nh s√°ch b·∫£o
            m·∫≠t</a> | <a href="#" class="hover:text-blue-500">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a></p>
    </div>
</footer>
</body>
<script type="module" th:src="@{/js/main.js}" defer></script>
<script th:src="@{/js/websocket_connect.js}" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const userMenu = document.querySelector("#user-menu");
        const dropdown = document.querySelector("#layout-dropdown");

        if (userMenu && dropdown) {
            // Khi click v√†o avatar ho·∫∑c t√™n ng∆∞·ªùi d√πng
            userMenu.addEventListener("click", (e) => {
                e.stopPropagation(); // ch·∫∑n lan ra ngo√†i
                dropdown.classList.toggle("opacity-100");
                dropdown.classList.toggle("visible");
                dropdown.classList.toggle("opacity-0");
                dropdown.classList.toggle("invisible");
            });

            // Khi click ra ngo√†i th√¨ ƒë√≥ng dropdown
            document.addEventListener("click", (e) => {
                if (!userMenu.contains(e.target)) {
                    dropdown.classList.remove("opacity-100", "visible");
                    dropdown.classList.add("opacity-0", "invisible");
                }
            });
        }
    });
</script>

</html>
